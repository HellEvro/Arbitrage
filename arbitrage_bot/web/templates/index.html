<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <title>Arbitrage Ranking</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}" />
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js" crossorigin="anonymous"></script>
  </head>
  <body>
    <main>
      <h1>Arbitrage Opportunities</h1>
      
      <!-- Статус бирж -->
      <div id="exchange-status-panel" class="exchange-status-panel">
        <div class="exchange-status-header">
          <h2>Статус подключения к биржам</h2>
        </div>
        <div id="exchange-status-list" class="exchange-status-list">
          <!-- Статусы будут добавлены через JavaScript -->
        </div>
      </div>
      
      <!-- Панель управления -->
      <div class="controls-panel">
        <div class="control-group">
          <label for="limit-select">Показать:</label>
          <select id="limit-select">
            <option value="10">Топ 10</option>
            <option value="20" selected>Топ 20</option>
            <option value="50">Топ 50</option>
            <option value="100">Топ 100</option>
            <option value="all">Все</option>
            <option value="custom">Произвольное</option>
          </select>
          <input type="number" id="custom-limit" min="1" max="1000" value="20" style="display: none; width: 80px; margin-left: 10px;" />
        </div>
        
        <div class="control-group">
          <label for="sort-select">Сортировать по:</label>
          <select id="sort-select">
            <option value="spread_usdt" selected>Прибыль (USDT)</option>
            <option value="spread_pct">Прибыль (%)</option>
            <option value="symbol">Монета</option>
            <option value="buy_price">Цена покупки</option>
            <option value="sell_price">Цена продажи</option>
          </select>
        </div>
        
        <div class="control-group">
          <label for="search-input">Поиск:</label>
          <input type="text" id="search-input" placeholder="Введите символ монеты..." style="width: 200px;" />
        </div>
        
        <div class="control-group">
          <button id="freeze-btn" class="btn btn-secondary">⏸ Зафиксировать</button>
          <span id="freeze-status" class="status-indicator"></span>
        </div>
        
      </div>

      <!-- Табы -->
      <div class="tabs">
        <button id="collapse-all-btn" class="collapse-all-tab-btn" onclick="toggleAllGroups()" title="Свернуть/развернуть все монеты">
          <span class="collapse-all-icon">▼</span>
        </button>
        <button class="tab-btn active" data-tab="main">Основная таблица</button>
        <button class="tab-btn" data-tab="settings">Настройки</button>
      </div>

      <!-- Контент табов -->
      <div class="tab-content">
        <!-- Основная таблица -->
        <div id="tab-main" class="tab-pane active">
          <div id="ranking-table-wrapper">
          <table id="ranking-table">
            <thead>
              <tr>
                <th>Монета</th>
                <th>Биржа min</th>
                <th>Цена min</th>
                <th>Комиссия min</th>
                <th>Биржа max</th>
                <th>Цена max</th>
                <th>Комиссия max</th>
                <th>Валовая прибыль (USDT)</th>
                <th>Комиссии (USDT)</th>
                <th>Чистая прибыль (USDT)</th>
                <th>Прибыль (%)</th>
                <th>Обновлено</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          </div>
        </div>

        <!-- Настройки -->
        <div id="tab-settings" class="tab-pane">
          <!-- Параметры фильтрации -->
          <div class="settings-panel">
            <h2>Параметры фильтрации монет</h2>
            <p class="help-text" style="margin-bottom: 1rem; color: #666;">
              Эти параметры управляют тем, как система определяет одинаковые и разные монеты на разных биржах.
              Изменения требуют перезапуска сервера (настройки в config.yaml).
            </p>
            
            <div class="filtering-config-grid">
              <div class="config-section">
                <h3>Backend (серверная фильтрация)</h3>
                
                <div class="config-item">
                  <label for="same-coin-ratio">Same Coin Ratio:</label>
                  <input type="number" id="same-coin-ratio" step="0.01" min="1.0" readonly />
                  <span class="config-description">Разница до N% - это одна монета (для идентичных названий)</span>
                </div>
                
                <div class="config-item">
                  <label for="likely-same-coin-ratio">Likely Same Coin Ratio:</label>
                  <input type="number" id="likely-same-coin-ratio" step="0.01" min="1.0" readonly />
                  <span class="config-description">Разница до N% - скорее всего одна монета (для разных длин названий)</span>
                </div>
                
                <div class="config-item">
                  <label for="different-coin-ratio">Different Coin Ratio:</label>
                  <input type="number" id="different-coin-ratio" step="0.01" min="1.0" readonly />
                  <span class="config-description">Разница >= N - точно разные монеты</span>
                </div>
                
                <div class="config-item">
                  <label for="min-price-threshold">Min Price Threshold:</label>
                  <input type="number" id="min-price-threshold" step="1e-7" min="0" readonly />
                  <span class="config-description">Цены меньше этого считаем практически нулевыми</span>
                </div>
                
                <div class="config-item">
                  <label for="price-ratio-threshold">Price Ratio Threshold:</label>
                  <input type="number" id="price-ratio-threshold" step="0.1" min="1.0" readonly />
                  <span class="config-description">Если цена в N раз больше - это разные монеты</span>
                </div>
                
                <div class="config-item">
                  <label for="stable-window-minutes">Stable Window (минуты):</label>
                  <input type="number" id="stable-window-minutes" step="0.1" min="0" readonly />
                  <span class="config-description">Окно стабильности для пометки стабильных арбитражей</span>
                </div>
              </div>
              
              <div class="config-section">
                <h3>Frontend (группировка на странице)</h3>
                
                <div class="config-item">
                  <label for="price-diff-suspicious">Price Diff Suspicious:</label>
                  <input type="number" id="price-diff-suspicious" step="0.1" min="0" readonly />
                  <span class="config-description">N% - подозрительная разница</span>
                </div>
                
                <div class="config-item">
                  <label for="price-diff-threshold">Price Diff Threshold:</label>
                  <input type="number" id="price-diff-threshold" step="0.1" min="0" readonly />
                  <span class="config-description">N% (в 2 раза) - точно разные монеты</span>
                </div>
                
                <div class="config-item">
                  <label for="price-diff-aggressive">Price Diff Aggressive:</label>
                  <input type="number" id="price-diff-aggressive" step="0.1" min="0" readonly />
                  <span class="config-description">N% (в 3 раза) - агрессивное разделение</span>
                </div>
              </div>
            </div>
          </div>
          
          <div class="settings-panel" style="margin-top: 2rem;">
            <h2>Настройки отображения</h2>
            <div class="setting-item">
              <label>
                <input type="checkbox" id="enable-blacklist" checked />
                Использовать черный список
              </label>
            </div>
            <div class="setting-item">
              <label>
                <input type="checkbox" id="enable-whitelist" />
                Использовать белый список (приоритет)
              </label>
            </div>
            <div class="setting-item">
              <label>
                <input type="checkbox" id="auto-sort-whitelist" checked />
                Автоматически сортировать белый список вверху
              </label>
            </div>
            <div class="setting-item">
              <button id="clear-all-btn" class="btn btn-danger">Очистить все списки</button>
            </div>
          </div>

          <!-- Черный список -->
          <div class="list-management" style="margin-top: 2rem;">
            <h2>Черный список монет</h2>
            <p class="help-text">Монеты из этого списка не будут отображаться в основной таблице</p>
            <div class="add-item-form">
              <input type="text" id="blacklist-input" placeholder="Введите символ монеты (например, BTCUSDT)" />
              <button id="add-blacklist-btn" class="btn btn-primary">Добавить</button>
            </div>
            <div id="blacklist-items" class="list-items"></div>
          </div>

          <!-- Белый список -->
          <div class="list-management" style="margin-top: 2rem;">
            <h2>Белый список монет</h2>
            <p class="help-text">Монеты из этого списка будут показываться в приоритете вверху таблицы</p>
            <div class="add-item-form">
              <input type="text" id="whitelist-input" placeholder="Введите символ монеты (например, BTCUSDT)" />
              <button id="add-whitelist-btn" class="btn btn-primary">Добавить</button>
            </div>
            <div id="whitelist-items" class="list-items"></div>
          </div>
        </div>
      </div>
    </main>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
  </body>
</html>
